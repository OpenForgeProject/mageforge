#!/bin/bash

## #ddev-generated
## Description: Run phpcbf (auto-fix coding standard issues)
## Usage: phpcbf [path]
## Example: ddev phpcbf
## Example: ddev phpcbf src/src/Service/StaticContentCleaner.php
## Example: ddev phpcbf vendor/openforgeproject/mageforge/src/Block

cd /var/www/html/magento || exit 1

PHPCBF_BIN="vendor/bin/phpcbf"

# Set target path - default to vendor/openforgeproject/mageforge/src if not provided
TARGET_PATH="vendor/openforgeproject/mageforge/src"
if [[ $# -gt 0 ]] && [[ ! "$1" =~ ^- ]]; then
	TARGET_PATH="$1"
	shift # Remove the first argument

	# If path doesn't exist from magento dir, try from workspace root
	if [[ ! -e "${TARGET_PATH}" ]] && [[ -e "../${TARGET_PATH}" ]]; then
		TARGET_PATH="../${TARGET_PATH}"
	fi
fi

# Run PHPCBF with optional additional flags
"${PHPCBF_BIN}" -p -s --standard=Magento2 "$@" "${TARGET_PATH}"
